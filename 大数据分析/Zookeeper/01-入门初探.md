# 1 基础

## 1.1 HBase

数据库技术，nosql，随机访问，实时读取，延迟低，构建在Hadoop之上。

hive是离线计算，主要做分析，延迟高。

## 1.2 SPOF

单点故障，single point of failure

## 1.3 HA

高可用，high availability

# 2 ZooKeeper

## 概念

ZooKeeper是一个集中的服务，用于维护配置信息、命名、提供分布式同步和提供组服务。

协同服务，用于名称服务、分组服务、配置信息等等，使用简单架构和API实现分布式管理。

## 分布式应用的好处

1、可靠性单个或几个节点故障不会导致整个系统的故障。

2、可伸缩无需下线，通过添加主机很少配置修改实现性能提升

3、透明性隐藏复杂性，仍表示为一个应用

## 分布式应用的挑战

1、竞态条件，多个主机执行同一个特殊任务。

2、死锁的情况。

3、不一致，数据部分失效。

## ACID

Atomic  // 原子性，不可分割

consistence  // 

isolate

durable

n/2

集群节点个数推荐奇数个，原因是一半机器挂掉就不对外提供服务。

# 3 安装过程

## 3.1 单机安装

步骤一：上传zookeeper-3.3.6.tar.gz

步骤二：解压到指定的文件夹中（本人解压到/usr/local/soft下）

步骤三：安装目录下conf/zoo_sample.cfg重命名zoo.cfg

```properties
# The number of milliseconds of each tick  
tickTime=2000  
# The number of ticks that the initial   
# synchronization phase can take  
initLimit=10  
# The number of ticks that can pass between   
# sending a request and getting an acknowledgement  
syncLimit=5  
# the directory where the snapshot is stored.  
# do not use /tmp for storage, /tmp here is just   
# example sakes.  
dataDir=/usr/local/soft/zookeeper-3.3.6/data  
dataLogDir=/usr/local/soft/zookeeper-3.3.6/log  
# the port at which the clients will connect  
clientPort=2181  
# the maximum number of client connections.  
# increase this if you need to handle more clients  
#maxClientCnxns=60  
#  
# Be sure to read the maintenance section of the   
# administrator guide before turning on autopurge.  
#  
# http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance  
#  
# The number of snapshots to retain in dataDir  
#autopurge.snapRetainCount=3  
# Purge task interval in hours  
# Set to "0" to disable auto purge feature  
#autopurge.purgeInterval=1  
```

3.3 启动

1. 启动ZK服务:       sh bin/zkServer.sh start
2. 停止ZK服务:       sh bin/zkServer.sh stop
3. 重启ZK服务:       sh bin/zkServer.sh restart
4. 查看ZK服务状态: sh bin/zkServer.sh status

3.4 验证

[root@iz2ze0h59yk0rf0sem4w0pz ~]# jps
27819 QuorumPeerMain
28603 Jps

## 3.2 伪分布式



## 3.3 完全分布式



# 4 zkCli

create  -e 临时节点 -s序列节点

$zk>create /zk/node1 tom

$zk>create -s /a/b ""

$zk>create -s /a/b ""

$zk>create -e /a/c ""

$zk>get -s /zk/node1

```properties
 addWatch [-m mode] path # optional mode is one of [PERSISTENT, PERSISTENT_RECURSIVE] - default is PERSISTENT_RECURSIVE                                               
 addauth scheme auth                                                        
 close                                                                      
 config [-c] [-w] [-s]                                                     
 connect host:port                                                          
 create [-s] [-e] [-c] [-t ttl] path [data] [acl]                          
 delete [-v version] path                                                   
 deleteall path [-b batch size]                                             
 delquota [-n|-b] path                                                      
 get [-s] [-w] path                                                         
 getAcl [-s] path                                                          
 getAllChildrenNumber path                                                   
 getEphemerals path                                                        
 history                                                                   
 listquota path                                                            
 ls [-s] [-w] [-R] path                                                  
 printwatches on|off                                                        
 quit                                                                   
 reconfig [-s] [-v version] [[-file path] | [-members serverID=host:port1:port2;port3[,...]*]] | [-add serverId=host:port1:port2;port3[,...]]* [-remove serverId[,...]                                                  
 redo cmdno                                                                 
 removewatches path [-c|-d|-a] [-l]                                       
 set [-s] [-v version] path data                                           
 setAcl [-s] [-v version] [-R] path acl                                    
 setquota -n|-b val path                                                   
 stat [-w] path                                                           
 sync path                                                                  
 version                                                            
```



# 5 Watch

观察者模式，通知模式，trigger激活机制。

观察指定路径上的数据变化，一次性的

